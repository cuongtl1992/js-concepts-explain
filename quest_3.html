<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Array Splice Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        
        h1 {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .array-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .array-box {
            width: 60px;
            height: 60px;
            margin: 0 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #3498db;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            background-color: #fff;
            position: relative;
        }
        
        .array-box .index {
            position: absolute;
            top: -25px;
            font-size: 14px;
            font-weight: normal;
            color: #666;
        }
        
        .pointer {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 16px solid #e74c3c;
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .pointer-label {
            position: absolute;
            top: -62px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .code-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 16px;
        }
        
        .code-current-line {
            background-color: #ffe6e6;
            display: inline-block;
            width: 100%;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .explanation {
            line-height: 1.6;
            margin: 20px 0;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .conclusion {
            margin-top: 30px;
            padding: 15px;
            border-left: 4px solid #3498db;
            background-color: #e7f4ff;
        }
        
        .spliced {
            border-color: #e74c3c;
            background-color: #ffeeee;
        }
        
        .skipped {
            border-color: #f39c12;
            background-color: #fff8e6;
        }
        
        .checked {
            border-color: #2ecc71;
            background-color: #eafaf1;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 4px;
        }
        
        .status-log {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 150px;
            overflow-y: auto;
            font-family: monospace;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ddd;
        }
        
        .step-info {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Understanding Array Modification During Iteration</h1>
        
        <div class="code-container">
const arr = [1, 2, 3, 2, 2];
for (let i = 0; i < arr.length; i++) {
    if (arr[i] === 2) {
        arr.splice(i, 1);
    }
}
console.log(arr);</div>
        
        <div class="step-info" id="step-info">Initializing array [1, 2, 3, 2, 2]</div>
        
        <div class="array-container" id="array-container"></div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #eafaf1; border: 2px solid #2ecc71;"></div>
                <span>Checked</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ffeeee; border: 2px solid #e74c3c;"></div>
                <span>Spliced</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #fff8e6; border: 2px solid #f39c12;"></div>
                <span>Skipped</span>
            </div>
        </div>
        
        <div class="status-log" id="log"></div>
        
        <div class="controls">
            <button id="startBtn">Start Animation</button>
            <button id="resetBtn">Reset</button>
        </div>
        
        <div class="explanation">
            <h3>Problem Explanation:</h3>
            <p>
                When we modify an array while iterating over it with a forward loop, we can encounter unexpected behavior. 
                In this example, we're removing elements with value '2' using <code>splice()</code>, which changes the array length and shifts elements.
            </p>
            <p>
                The key issue: After removing an element at index i, the element that was at position i+1 moves to position i, 
                but our loop then advances to i+1, <span class="highlight">skipping the element that just shifted into position i</span>.
            </p>
        </div>
        
        <div class="conclusion">
            <h3>Solutions:</h3>
            <p>1. Iterate backwards: <code>for (let i = arr.length - 1; i >= 0; i--)</code></p>
            <p>2. Use filter to create a new array: <code>const filtered = arr.filter(item => item !== 2);</code></p>
            <p>3. Create a copy before iterating: <code>const arrCopy = [...arr];</code></p>
        </div>
    </div>

    <script>
        const originalArray = [1, 2, 3, 2, 2];
        let currentArray = [...originalArray];
        let currentIndex = -1;
        let timeline;
        let isAnimating = false;
        
        const arrayContainer = document.getElementById('array-container');
        const logElement = document.getElementById('log');
        const stepInfo = document.getElementById('step-info');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        function renderArray() {
            arrayContainer.innerHTML = '';
            
            currentArray.forEach((value, index) => {
                const box = document.createElement('div');
                box.className = 'array-box';
                box.innerHTML = value;
                
                const indexElem = document.createElement('div');
                indexElem.className = 'index';
                indexElem.textContent = `i: ${index}`;
                box.appendChild(indexElem);
                
                if (index === currentIndex) {
                    const pointer = document.createElement('div');
                    pointer.className = 'pointer';
                    box.appendChild(pointer);
                    
                    const pointerLabel = document.createElement('div');
                    pointerLabel.className = 'pointer-label';
                    pointerLabel.textContent = 'i = ' + index;
                    box.appendChild(pointerLabel);
                }
                
                arrayContainer.appendChild(box);
            });
        }
        
        function addLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = message;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function reset() {
            if (timeline) {
                timeline.kill();
            }
            
            currentArray = [...originalArray];
            currentIndex = -1;
            isAnimating = false;
            
            renderArray();
            logElement.innerHTML = '';
            stepInfo.textContent = 'Initializing array [1, 2, 3, 2, 2]';
            startBtn.disabled = false;
            addLog('Array reset to [1, 2, 3, 2, 2]');
        }
        
        function startAnimation() {
            if (isAnimating) return;
            isAnimating = true;
            startBtn.disabled = true;
            
            timeline = gsap.timeline({
                onComplete: () => {
                    isAnimating = false;
                    stepInfo.textContent = `Final result: [${currentArray.join(', ')}]`;
                    addLog(`Animation complete. Final array: [${currentArray.join(', ')}]`);
                }
            });
            
            addLog('Starting animation...');
            
            // Step 1: i = 0, value = 1
            timeline.call(() => {
                currentIndex = 0;
                renderArray();
                stepInfo.textContent = `Checking index ${currentIndex}, value = ${currentArray[currentIndex]}`;
                addLog(`Checking arr[${currentIndex}] = ${currentArray[currentIndex]}`);
                
                const boxes = document.querySelectorAll('.array-box');
                gsap.to(boxes[currentIndex], { 
                    backgroundColor: '#eafaf1', 
                    borderColor: '#2ecc71',
                    duration: 0.5
                });
            }, null, 0.5);
            
            timeline.call(() => {
                addLog(`${currentArray[currentIndex]} !== 2, so we don't splice`);
            }, null, "+=0.5");
            
            // Step 2: i = 1, value = 2
            timeline.call(() => {
                currentIndex = 1;
                renderArray();
                stepInfo.textContent = `Checking index ${currentIndex}, value = ${currentArray[currentIndex]}`;
                addLog(`Checking arr[${currentIndex}] = ${currentArray[currentIndex]}`);
                
                const boxes = document.querySelectorAll('.array-box');
                gsap.to(boxes[currentIndex], { 
                    backgroundColor: '#ffeeee', 
                    borderColor: '#e74c3c',
                    duration: 0.5
                });
            }, null, "+=0.5");
            
            timeline.call(() => {
                addLog(`${currentArray[currentIndex]} === 2, so we splice at index ${currentIndex}`);
                currentArray.splice(currentIndex, 1);
                addLog(`After splice: [${currentArray.join(', ')}]`);
                renderArray();
                
                // Highlight the shift of elements
                stepInfo.textContent = `Spliced at index ${currentIndex}, array is now [${currentArray.join(', ')}]`;
                
                // Showing how elements shifted
                const shiftText = document.createElement('div');
                shiftText.textContent = '⚠️ Elements to the right shifted left one position';
                shiftText.style.color = '#e74c3c';
                shiftText.style.textAlign = 'center';
                shiftText.style.marginTop = '10px';
                shiftText.style.fontWeight = 'bold';
                arrayContainer.appendChild(shiftText);
                
                gsap.from(shiftText, {
                    opacity: 0,
                    y: -10,
                    duration: 0.5
                });
            }, null, "+=1");
            
            // Step 3: i = 2, value = 2 (was 3 originally, but now shifted to 2)
            timeline.call(() => {
                currentIndex = 2;
                renderArray();
                
                const shiftedValue = document.createElement('div');
                shiftedValue.textContent = '⚠️ This was originally 3, but is now 2';
                shiftedValue.style.color = '#f39c12';
                shiftedValue.style.textAlign = 'center';
                shiftedValue.style.marginTop = '10px';
                shiftedValue.style.fontWeight = 'bold';
                arrayContainer.appendChild(shiftedValue);
                
                gsap.from(shiftedValue, {
                    opacity: 0,
                    y: -10,
                    duration: 0.5
                });
                
                stepInfo.textContent = `Important: Loop moves to index ${currentIndex}, value = ${currentArray[currentIndex]}`;
                addLog(`Moving to arr[${currentIndex}] = ${currentArray[currentIndex]}`);
                
                const boxes = document.querySelectorAll('.array-box');
                gsap.to(boxes[currentIndex], { 
                    backgroundColor: '#eafaf1', 
                    borderColor: '#2ecc71',
                    duration: 0.5
                });
            }, null, "+=1.5");
            
            timeline.call(() => {
                addLog(`${currentArray[currentIndex]} === 2, so we splice at index ${currentIndex}`);
                currentArray.splice(currentIndex, 1);
                addLog(`After splice: [${currentArray.join(', ')}]`);
                renderArray();
                
                stepInfo.textContent = `Spliced at index ${currentIndex}, array is now [${currentArray.join(', ')}]`;
                
                // Show what was skipped
                const skippedText = document.createElement('div');
                skippedText.textContent = '⚠️ Original last 2 has shifted to index 2';
                skippedText.style.color = '#f39c12';
                skippedText.style.textAlign = 'center';
                skippedText.style.marginTop = '10px';
                skippedText.style.fontWeight = 'bold';
                arrayContainer.appendChild(skippedText);
                
                gsap.from(skippedText, {
                    opacity: 0,
                    y: -10,
                    duration: 0.5
                });
            }, null, "+=1");
            
            // Step 4: i = 3, out of bounds
            timeline.call(() => {
                currentIndex = 3;
                
                stepInfo.textContent = `Loop tries to move to index ${currentIndex}, but array length is now ${currentArray.length}`;
                addLog(`Trying to check arr[${currentIndex}], but this is out of bounds`);
                addLog(`Loop terminates because ${currentIndex} >= ${currentArray.length}`);
                
                const outOfBoundsText = document.createElement('div');
                outOfBoundsText.textContent = '⚠️ Loop ends because i >= array.length';
                outOfBoundsText.style.color = '#e74c3c';
                outOfBoundsText.style.textAlign = 'center';
                outOfBoundsText.style.marginTop = '40px';
                outOfBoundsText.style.fontWeight = 'bold';
                arrayContainer.appendChild(outOfBoundsText);
                
                gsap.from(outOfBoundsText, {
                    opacity: 0,
                    y: -10,
                    duration: 0.5
                });
            }, null, "+=1");
            
            // Final step - Show result
            timeline.call(() => {
                currentIndex = -1;
                renderArray();
                
                const resultText = document.createElement('div');
                resultText.innerHTML = `<h3>Final Result:</h3>`;
                resultText.style.textAlign = 'center';
                resultText.style.marginTop = '20px';
                arrayContainer.appendChild(resultText);
                
                const resultArray = document.createElement('div');
                resultArray.textContent = `console.log(arr) → [${currentArray.join(', ')}]`;
                resultArray.style.fontSize = '22px';
                resultArray.style.fontWeight = 'bold';
                resultArray.style.textAlign = 'center';
                resultArray.style.marginTop = '10px';
                resultArray.style.padding = '10px';
                resultArray.style.backgroundColor = '#e7f4ff';
                resultArray.style.borderRadius = '8px';
                arrayContainer.appendChild(resultArray);
                
                addLog(`Final array: [${currentArray.join(', ')}]`);
                stepInfo.textContent = `Answer is d) [1, 3, 2]`;
                
                gsap.from([resultText, resultArray], {
                    opacity: 0,
                    y: -10,
                    stagger: 0.3,
                    duration: 0.8
                });
            }, null, "+=1.5");
        }
        
        startBtn.addEventListener('click', startAnimation);
        resetBtn.addEventListener('click', reset);
        
        // Initial render
        reset();
    </script>
</body>
</html>